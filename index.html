const flipper = document.getElementById("flipper");
const cardFront = document.getElementById("cardFront");
const cardBack = document.getElementById("cardBack");
const drawBtn = document.getElementById("drawBtn");
const resetBtn = document.getElementById("resetBtn");
const currentLink = document.getElementById("currentLink");
const currentArcana = document.getElementById("currentArcana");
const hint = document.getElementById("hint");
const sitePick = document.getElementById("sitePick");

let lastCard = null;

function showBack(){
  lastCard = null;
  flipper.classList.remove("flipped");
  hint.textContent = "Tap the card";
  currentLink.textContent = "Tap the card";
  currentLink.removeAttribute("href");
  currentArcana.textContent = "";
  drawBtn.textContent = "Draw";
  resetBtn.style.display = "none";
}

function draw(){
  lastCard = deck[Math.floor(Math.random()*deck.length)];

  const img = imagePath(lastCard.name);
  cardBack.src = img;

  flipper.classList.add("flipped");

  const url = siteBuilders[sitePick.value].url(lastCard);

  currentLink.textContent = lastCard.name;
  currentLink.href = url;
  currentLink.target = "_blank";

  currentArcana.textContent = ` â€” ${lastCard.arcana}`;

  hint.textContent = "Tap the card";
  drawBtn.textContent = "Draw again";
  resetBtn.style.display = "inline-block";
}

function openMeaning(){
  if (!lastCard) return;
  const url = siteBuilders[sitePick.value].url(lastCard);
  window.open(url, "_blank");
}

drawBtn.addEventListener("click", draw);
resetBtn.addEventListener("click", showBack);

flipper.addEventListener("click", () => {
  if (!lastCard) draw();
  else openMeaning();
});

sitePick.addEventListener("change", () => {
  if (!lastCard) return;
  const url = siteBuilders[sitePick.value].url(lastCard);
  currentLink.href = url;
});

showBack();
